<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>BIAN Service Landscape v13.0 by Andrew Koay, CISA.</title>
  <style>
    text {
	  font: 11px sans-serif;
	}
  
	.node rect {
	cursor: move;
	fill-opacity: .9;
	shape-rendering: crispEdges;
	}

	.node text {
	pointer-events: none;
	text-shadow: 0 1px 0 #fff;
	}

	.link {
	fill: none;
	stroke: #000;
	stroke-opacity: .2;
	}

	.link:hover {
	stroke-opacity: .5;
	}
  </style>
  <script src="https://d3js.org/d3.v3.min.js"></script>
<script lang="javascript">
d3.sankey = function() {
  var sankey = {},
      nodeWidth = 24,
      nodePadding = 8,
      size = [1, 1],
      nodes = [],
      links = [];

  sankey.nodeWidth = function(_) {
    if (!arguments.length) return nodeWidth;
    nodeWidth = +_;
    return sankey;
  };

  sankey.nodePadding = function(_) {
    if (!arguments.length) return nodePadding;
    nodePadding = +_;
    return sankey;
  };

  sankey.nodes = function(_) {
    if (!arguments.length) return nodes;
    nodes = _;
    return sankey;
  };

  sankey.links = function(_) {
    if (!arguments.length) return links;
    links = _;
    return sankey;
  };

  sankey.size = function(_) {
    if (!arguments.length) return size;
    size = _;
    return sankey;
  };

  sankey.layout = function(iterations) {
    computeNodeLinks();
    computeNodeValues();
    computeNodeBreadths();
    computeNodeDepths(iterations);
    computeLinkDepths();
    return sankey;
  };

  sankey.relayout = function() {
    computeLinkDepths();
    return sankey;
  };

  sankey.link = function() {
    var curvature = .5;

    function link(d) {
      var x0 = d.source.x + d.source.dx,
          x1 = d.target.x,
          xi = d3.interpolateNumber(x0, x1),
          x2 = xi(curvature),
          x3 = xi(1 - curvature),
          y0 = d.source.y + d.sy + d.dy / 2,
          y1 = d.target.y + d.ty + d.dy / 2;
      return "M" + x0 + "," + y0
           + "C" + x2 + "," + y0
           + " " + x3 + "," + y1
           + " " + x1 + "," + y1;
    }

    link.curvature = function(_) {
      if (!arguments.length) return curvature;
      curvature = +_;
      return link;
    };

    return link;
  };

  // Populate the sourceLinks and targetLinks for each node.
  // Also, if the source and target are not objects, assume they are indices.
  function computeNodeLinks() {
    nodes.forEach(function(node) {
      node.sourceLinks = [];
      node.targetLinks = [];
    });
    links.forEach(function(link) {
      var source = link.source,
          target = link.target;
      if (typeof source === "number") source = link.source = nodes[link.source];
      if (typeof target === "number") target = link.target = nodes[link.target];
      source.sourceLinks.push(link);
      target.targetLinks.push(link);
    });
  }

  // Compute the value (size) of each node by summing the associated links.
  function computeNodeValues() {
    nodes.forEach(function(node) {
      node.value = Math.max(
        d3.sum(node.sourceLinks, value),
        d3.sum(node.targetLinks, value)
      );
    });
  }

  // Iteratively assign the breadth (x-position) for each node.
  // Nodes are assigned the maximum breadth of incoming neighbors plus one;
  // nodes with no incoming links are assigned breadth zero, while
  // nodes with no outgoing links are assigned the maximum breadth.
  function computeNodeBreadths() {
    var remainingNodes = nodes,
        nextNodes,
        x = 0;

    while (remainingNodes.length) {
      nextNodes = [];
      remainingNodes.forEach(function(node) {
        node.x = x;
        node.dx = nodeWidth;
        node.sourceLinks.forEach(function(link) {
          nextNodes.push(link.target);
        });
      });
      remainingNodes = nextNodes;
      ++x;
    }

    //
    moveSinksRight(x);
    scaleNodeBreadths((width - nodeWidth) / (x - 1));
  }

  function moveSourcesRight() {
    nodes.forEach(function(node) {
      if (!node.targetLinks.length) {
        node.x = d3.min(node.sourceLinks, function(d) { return d.target.x; }) - 1;
      }
    });
  }

  function moveSinksRight(x) {
    nodes.forEach(function(node) {
      if (!node.sourceLinks.length) {
        node.x = x - 1;
      }
    });
  }

  function scaleNodeBreadths(kx) {
    nodes.forEach(function(node) {
      node.x *= kx;
    });
  }

  function computeNodeDepths(iterations) {
    var nodesByBreadth = d3.nest()
        .key(function(d) { return d.x; })
        .sortKeys(d3.ascending)
        .entries(nodes)
        .map(function(d) { return d.values; });

    //
    initializeNodeDepth();
    resolveCollisions();
    for (var alpha = 1; iterations > 0; --iterations) {
      relaxRightToLeft(alpha *= .99);
      resolveCollisions();
      relaxLeftToRight(alpha);
      resolveCollisions();
    }

    function initializeNodeDepth() {
      var ky = d3.min(nodesByBreadth, function(nodes) {
        return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);
      });

      nodesByBreadth.forEach(function(nodes) {
        nodes.forEach(function(node, i) {
          node.y = i;
          node.dy = node.value * ky;
        });
      });

      links.forEach(function(link) {
        link.dy = link.value * ky;
      });
    }

    function relaxLeftToRight(alpha) {
      nodesByBreadth.forEach(function(nodes, breadth) {
        nodes.forEach(function(node) {
          if (node.targetLinks.length) {
            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);
            node.y += (y - center(node)) * alpha;
          }
        });
      });

      function weightedSource(link) {
        return center(link.source) * link.value;
      }
    }

    function relaxRightToLeft(alpha) {
      nodesByBreadth.slice().reverse().forEach(function(nodes) {
        nodes.forEach(function(node) {
          if (node.sourceLinks.length) {
            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);
            node.y += (y - center(node)) * alpha;
          }
        });
      });

      function weightedTarget(link) {
        return center(link.target) * link.value;
      }
    }

    function resolveCollisions() {
      nodesByBreadth.forEach(function(nodes) {
        var node,
            dy,
            y0 = 0,
            n = nodes.length,
            i;

        // Push any overlapping nodes down.
        nodes.sort(ascendingDepth);
        for (i = 0; i < n; ++i) {
          node = nodes[i];
          dy = y0 - node.y;
          if (dy > 0) node.y += dy;
          y0 = node.y + node.dy + nodePadding;
        }

        // If the bottommost node goes outside the bounds, push it back up.
        dy = y0 - nodePadding - size[1];
        if (dy > 0) {
          y0 = node.y -= dy;

          // Push any overlapping nodes back up.
          for (i = n - 2; i >= 0; --i) {
            node = nodes[i];
            dy = node.y + node.dy + nodePadding - y0;
            if (dy > 0) node.y -= dy;
            y0 = node.y;
          }
        }
      });
    }

    function ascendingDepth(a, b) {
      return a.y - b.y;
    }
  }

  function computeLinkDepths() {
    nodes.forEach(function(node) {
      node.sourceLinks.sort(ascendingTargetDepth);
      node.targetLinks.sort(ascendingSourceDepth);
    });
    nodes.forEach(function(node) {
      var sy = 0, ty = 0;
      node.sourceLinks.forEach(function(link) {
        link.sy = sy;
        sy += link.dy;
      });
      node.targetLinks.forEach(function(link) {
        link.ty = ty;
        ty += link.dy;
      });
    });

    function ascendingSourceDepth(a, b) {
      return a.source.y - b.source.y;
    }

    function ascendingTargetDepth(a, b) {
      return a.target.y - b.target.y;
    }
  }

  function center(node) {
    return node.y + node.dy / 2;
  }

  function value(link) {
    return link.value;
  }

  return sankey;
};
</script>  
</head>
<body>
  <h1>Dynamic, interactive visualization of BIAN Service Landscape v13.0</h1>
  <p id="chart">
  <footer>
  <small>Copyright &copy; 2026 Andrew Koay, CISA. This work provides a dynamic, interactive visualization of the <a href="https://bian.org/deliverables/service-landscape/">BIAN Service Landscape v13.0</a>. It is licensed under the ISC License and leverages the <a href="https://d3js.org/">D3.js JavaScript library</a>.
  <p>
  <b>ISC License</b><br>
  Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies. <br>
  THE SOFTWARE IS PROVIDED “AS IS” AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS.
  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  </p>
  </small>
  </footer>
<script lang="javascript">
const flare = [
  // Business Area: Reference Data
  {"source":"Reference Data","target":"Party","value":2},
  {"source":"Party","target":"Legal Entity Directory","value":1},
  {"source":"Party","target":"Party Routing Profile","value":1},
  {"source":"Reference Data","target":"External Agency","value":10},
  {"source":"External Agency","target":"Information Provider Administration","value":1},
  {"source":"External Agency","target":"Syndicate Management","value":1},
  {"source":"External Agency","target":"Interbank Relationship Management","value":1},
  {"source":"External Agency","target":"Correspondent Bank Relationship Management","value":1},
  {"source":"External Agency","target":"Correspondent Bank Directory","value":1},
  {"source":"External Agency","target":"Sub-Custodian Agreement","value":1},
  {"source":"External Agency","target":"Product Service Agency","value":1},
  {"source":"External Agency","target":"Product Broker Agreement","value":1},
  {"source":"External Agency","target":"Contractor and Supplier Agreement","value":1},
  {"source":"External Agency","target":"Service Provider Operations","value":1},
  {"source":"Reference Data","target":"Market Data","value":11},
  {"source":"Market Data","target":"Information Provider Operation","value":1},
  {"source":"Market Data","target":"Market Information Management","value":1},
  {"source":"Market Data","target":"Financial Market Analysis","value":1},
  {"source":"Market Data","target":"Financial Market Research","value":1},
  {"source":"Market Data","target":"Quant Model","value":1},
  {"source":"Market Data","target":"Market Data Switch Administration","value":1},
  {"source":"Market Data","target":"Market Data Switch Operation","value":1},
  {"source":"Market Data","target":"Financial Instrument Reference Data Management","value":1},
  {"source":"Market Data","target":"Counterparty Administration","value":1},
  {"source":"Market Data","target":"Public Reference Data Management","value":1},
  {"source":"Market Data","target":"Location Data Management","value":1},
  {"source":"Reference Data","target":"Product Management","value":7},
  {"source":"Product Management","target":"Product Design","value":1},
  {"source":"Product Management","target":"Product Deployment","value":1},
  {"source":"Product Management","target":"Product Training","value":1},
  {"source":"Product Management","target":"Product Quality Assurance","value":1},
  {"source":"Product Management","target":"Discount Pricing","value":1},
  {"source":"Product Management","target":"Product Directory","value":1},
  {"source":"Product Management","target":"Special Pricing Conditions","value":1},

  // Business Area: Sales and Service
  {"source":"Sales and Service","target":"Channel Specific","value":17},
  {"source":"Channel Specific","target":"Branch Location Management","value":1},
  {"source":"Channel Specific","target":"Contact Centre Management","value":1},
  {"source":"Channel Specific","target":"Branch Network Management","value":1},
  {"source":"Channel Specific","target":"eBranch Management","value":1},
  {"source":"Channel Specific","target":"Advanced Voice Services Management","value":1},
  {"source":"Channel Specific","target":"ATM Network Management","value":1},
  {"source":"Channel Specific","target":"Contact Centre Operations","value":1},
  {"source":"Channel Specific","target":"Branch Location Operations","value":1},
  {"source":"Channel Specific","target":"eBranch Operations","value":1},
  {"source":"Channel Specific","target":"Advanced Voice Services Operations","value":1},
  {"source":"Channel Specific","target":"ATM Network Operations","value":1},
  {"source":"Channel Specific","target":"Branch Currency Management","value":1},
  {"source":"Channel Specific","target":"Branch Currency Distribution","value":1},
  {"source":"Channel Specific","target":"Product Inventory Item Management","value":1},
  {"source":"Channel Specific","target":"Product Inventory Distribution","value":1},
  {"source":"Channel Specific","target":"Card Terminal Administration","value":1},
  {"source":"Channel Specific","target":"Card Terminal Operation","value":1},
  {"source":"Sales and Service","target":"Cross Channel","value":11},
  {"source":"Cross Channel","target":"Party Authentication","value":1},
  {"source":"Cross Channel","target":"Transaction Authorization","value":1},
  {"source":"Cross Channel","target":"Point of Service","value":1},
  {"source":"Cross Channel","target":"Servicing Event History","value":1},
  {"source":"Cross Channel","target":"Contact Routing","value":1},
  {"source":"Cross Channel","target":"Session Dialogue","value":1},
  {"source":"Cross Channel","target":"Interactive Help","value":1},
  {"source":"Cross Channel","target":"Contact Handler","value":1},
  {"source":"Cross Channel","target":"Customer Workbench","value":1},
  {"source":"Cross Channel","target":"Servicing Activity Analysis","value":1},
  {"source":"Cross Channel","target":"Service Directory","value":1},
  {"source":"Sales and Service","target":"Marketing","value":9},
  {"source":"Marketing","target":"Business Development","value":1},
  {"source":"Marketing","target":"Brand Management","value":1},
  {"source":"Marketing","target":"Advertising","value":1},
  {"source":"Marketing","target":"Promotional Events","value":1},
  {"source":"Marketing","target":"Prospect Campaign Management","value":1},
  {"source":"Marketing","target":"Prospect Campaign Design","value":1},
  {"source":"Marketing","target":"Customer Campaign Management","value":1},
  {"source":"Marketing","target":"Customer Campaign Design","value":1},
  {"source":"Marketing","target":"Customer Surveys","value":1},
  {"source":"Sales and Service","target":"Sales","value":13},
  {"source":"Sales","target":"Prospect Campaign Execution","value":1},
  {"source":"Sales","target":"Party Lifecycle Management","value":1},
  {"source":"Sales","target":"Lead and Opportunity Management","value":1},
  {"source":"Sales","target":"Customer Campaign Execution","value":1},
  {"source":"Sales","target":"Customer Offer","value":1},
  {"source":"Sales","target":"Sales Planning","value":1},
  {"source":"Sales","target":"Underwriting","value":1},
  {"source":"Sales","target":"Commission Agreement","value":1},
  {"source":"Sales","target":"Commissions","value":1},
  {"source":"Sales","target":"Product Matching","value":1},
  {"source":"Sales","target":"Product Expert Sales Support","value":1},
  {"source":"Sales","target":"Product Sales Support","value":1},
  {"source":"Sales","target":"Sales Product","value":1},
  {"source":"Sales and Service","target":"Customer Management","value":13},
  {"source":"Customer Management","target":"Customer Relationship Management","value":1},
  {"source":"Customer Management","target":"Customer Product And Service Eligibility","value":1},
  {"source":"Customer Management","target":"Customer Agreement","value":1},
  {"source":"Customer Management","target":"Sales Product Agreement","value":1},
  {"source":"Customer Management","target":"Customer Access Entitlement","value":1},
  {"source":"Customer Management","target":"Customer Behaviour Insights","value":1},
  {"source":"Customer Management","target":"Customer Credit Rating","value":1},
  {"source":"Customer Management","target":"Account Recovery","value":1},
  {"source":"Customer Management","target":"Customer Event History","value":1},
  {"source":"Customer Management","target":"Party Reference Data Directory","value":1},
  {"source":"Customer Management","target":"Customer Proposition","value":1},
  {"source":"Customer Management","target":"Customer Product and Service Directory","value":1},
  {"source":"Customer Management","target":"Customer Financial Insights","value":1},
  {"source":"Sales and Service","target":"Servicing","value":9},
  {"source":"Servicing","target":"Servicing Issue","value":1},
  {"source":"Servicing","target":"Customer Case Management","value":1},
  {"source":"Servicing","target":"Case Root Cause Analysis","value":1},
  {"source":"Servicing","target":"Customer Case","value":1},
  {"source":"Servicing","target":"Card Case","value":1},
  {"source":"Servicing","target":"Servicing Order","value":1},
  {"source":"Servicing","target":"Servicing Mandate","value":1},
  {"source":"Servicing","target":"Payment Initiation","value":1},
  {"source":"Servicing","target":"Loan Syndication","value":1},
  
  // Business Area: Operations and Execution
  {"source":"Operations and Execution","target":"Product Specific Fulfillment","value":79},
  {"source":"Product Specific Fulfillment","target":"Loans and Deposits","value":15},
  {"source":"Loans and Deposits","target":"Loan","value":1},
  {"source":"Loans and Deposits","target":"Leasing","value":1},
  {"source":"Loans and Deposits","target":"Current Account","value":1},
  {"source":"Loans and Deposits","target":"Term Deposit Framework Agreement","value":1},
  {"source":"Loans and Deposits","target":"Corporate Current Account","value":1},
  {"source":"Loans and Deposits","target":"Consumer Loan","value":1},
  {"source":"Loans and Deposits","target":"Corporate Loan","value":1},
  {"source":"Loans and Deposits","target":"Term Deposit","value":1},
  {"source":"Loans and Deposits","target":"Corporate Lease","value":1},
  {"source":"Loans and Deposits","target":"Merchandising Loan","value":1},
  {"source":"Loans and Deposits","target":"Mortgage Loan","value":1},
  {"source":"Loans and Deposits","target":"Fiduciary Agreement","value":1},
  {"source":"Loans and Deposits","target":"Savings Account","value":1},
  {"source":"Loans and Deposits","target":"Virtual Account","value":1},
  {"source":"Loans and Deposits","target":"Standing Order","value":1},
  {"source":"Product Specific Fulfillment","target":"Cards","value":7},
  {"source":"Cards","target":"Credit Card","value":1},
  {"source":"Cards","target":"Card Authorization","value":1},
  {"source":"Cards","target":"Card Transaction Capture","value":1},
  {"source":"Cards","target":"Merchant Relations","value":1},
  {"source":"Cards","target":"Merchant Acquiring Facility","value":1},
  {"source":"Cards","target":"Card Network Participant Facility","value":1},
  {"source":"Cards","target":"Credit Card Position Keeping","value":1},
  {"source":"Product Specific Fulfillment","target":"Corporate Financing and Advisory Services","value":5},
  {"source":"Corporate Financing and Advisory Services","target":"Corporate Finance","value":1},
  {"source":"Corporate Financing and Advisory Services","target":"Mergers and Acquisitions Advisory","value":1},
  {"source":"Corporate Financing and Advisory Services","target":"Corporate Tax Advisory","value":1},
  {"source":"Corporate Financing and Advisory Services","target":"Public Offering","value":1},
  {"source":"Corporate Financing and Advisory Services","target":"Private Placement","value":1},
  {"source":"Product Specific Fulfillment","target":"Investment Management","value":5},
  {"source":"Investment Management","target":"Investment Portfolio Planning","value":1},
  {"source":"Investment Management","target":"Investment Portfolio Analysis","value":1},
  {"source":"Investment Management","target":"Investment Portfolio Management","value":1},
  {"source":"Investment Management","target":"eTrading Workbench","value":1},
  {"source":"Investment Management","target":"Investment Account","value":1},
  {"source":"Product Specific Fulfillment","target":"Wholesale Trading","value":12},
  {"source":"Wholesale Trading","target":"Trading Book Oversight","value":1},
  {"source":"Wholesale Trading","target":"Trading Models","value":1},
  {"source":"Wholesale Trading","target":"Dealer Desk","value":1},
  {"source":"Wholesale Trading","target":"Quote Management","value":1},
  {"source":"Wholesale Trading","target":"Suitability Checking","value":1},
  {"source":"Wholesale Trading","target":"Credit Risk Operations","value":1},
  {"source":"Wholesale Trading","target":"Market Making","value":1},
  {"source":"Wholesale Trading","target":"ECM and DCM","value":1},
  {"source":"Wholesale Trading","target":"Program Trading","value":1},
  {"source":"Wholesale Trading","target":"Trader Position Operations","value":1},
  {"source":"Wholesale Trading","target":"Market Order","value":1},
  {"source":"Wholesale Trading","target":"Market Order Execution","value":1},
  {"source":"Product Specific Fulfillment","target":"Consumer Services","value":8},
  {"source":"Consumer Services","target":"Corporate Trust Services","value":1},
  {"source":"Consumer Services","target":"Currency Exchange","value":1},
  {"source":"Consumer Services","target":"Bank Drafts","value":1},
  {"source":"Consumer Services","target":"Brokered Product","value":1},
  {"source":"Consumer Services","target":"Consumer Investments","value":1},
  {"source":"Consumer Services","target":"Customer Tax Handling","value":1},
  {"source":"Consumer Services","target":"Consumer Advisory Services","value":1},
  {"source":"Consumer Services","target":"Trust Services","value":1},
  {"source":"Product Specific Fulfillment","target":"Trade Banking","value":15},
  {"source":"Trade Banking","target":"Letter of Credit","value":1},
  {"source":"Trade Banking","target":"Bank Guarantee","value":1},
  {"source":"Trade Banking","target":"Credit Management","value":1},
  {"source":"Trade Banking","target":"Credit Facility","value":1},
  {"source":"Trade Banking","target":"Project Finance","value":1},
  {"source":"Trade Banking","target":"Limit and Exposure Management","value":1},
  {"source":"Trade Banking","target":"Syndicated Loan","value":1},
  {"source":"Trade Banking","target":"Cash Management and Account Services","value":1},
  {"source":"Trade Banking","target":"Direct Debit","value":1},
  {"source":"Trade Banking","target":"Direct Debit Mandate","value":1},
  {"source":"Trade Banking","target":"Cheque Lock Box","value":1},
  {"source":"Trade Banking","target":"Factoring","value":1},
  {"source":"Trade Banking","target":"Cash Concentration","value":1},
  {"source":"Trade Banking","target":"Notional Pooling","value":1},
  {"source":"Trade Banking","target":"Corporate Payroll Services","value":1},
  {"source":"Product Specific Fulfillment","target":"Market Operations","value":12},
  {"source":"Market Operations","target":"Mutual Fund Administration","value":1},
  {"source":"Market Operations","target":"Hedge Fund Administration","value":1},
  {"source":"Market Operations","target":"Unit Trust Administration","value":1},
  {"source":"Market Operations","target":"Trade Confirmation Matching","value":1},
  {"source":"Market Operations","target":"Trade Clearing","value":1},
  {"source":"Market Operations","target":"Trade Settlement","value":1},
  {"source":"Market Operations","target":"Order Allocation","value":1},  
  {"source":"Market Operations","target":"Securities Fails Processing","value":1},
  {"source":"Market Operations","target":"Trade and Price Reporting","value":1},
  {"source":"Market Operations","target":"Custody Administration","value":1},
  {"source":"Market Operations","target":"Corporate Action","value":1},
  {"source":"Market Operations","target":"Financial Instrument Valuation","value":1},
  {"source":"Operations and Execution","target":"Cross Product Operations","value":43},
  {"source":"Cross Product Operations","target":"Payments","value":13},
  {"source":"Payments","target":"Payment Order","value":1},
  {"source":"Payments","target":"Payment Instruction","value":1},
  {"source":"Payments","target":"Payment Execution","value":1},
  {"source":"Payments","target":"Payment Rail Operations","value":1},
  {"source":"Payments","target":"Financial Message Analysis","value":1},
  {"source":"Payments","target":"Correspondent Bank Operations","value":1},
  {"source":"Payments","target":"Financial Gateway","value":1},
  {"source":"Payments","target":"Cheque Processing","value":1},
  {"source":"Payments","target":"Central Cash Handling","value":1},
  {"source":"Payments","target":"ACH Operations","value":1},
  {"source":"Payments","target":"Card eCommerce Gateway","value":1},
  {"source":"Payments","target":"Card Clearing","value":1},
  {"source":"Payments","target":"Card Financial Settlement","value":1},
  {"source":"Cross Product Operations","target":"Collateral Administration","value":4},
  {"source":"Collateral Administration","target":"Collateral Allocation Management","value":1},
  {"source":"Collateral Administration","target":"Collateral Asset Administration","value":1},
  {"source":"Collateral Administration","target":"Collections","value":1},
  {"source":"Collateral Administration","target":"Party Asset Directory","value":1},
  {"source":"Cross Product Operations","target":"Account Management","value":12},
  {"source":"Account Management","target":"Position Keeping","value":1},
  {"source":"Account Management","target":"Position Management","value":1},
  {"source":"Account Management","target":"Customer Position","value":1},
  {"source":"Account Management","target":"Securities Position Keeping","value":1},
  {"source":"Account Management","target":"Reward Points Account","value":1},
  {"source":"Account Management","target":"Accounts Receivable","value":1},
  {"source":"Account Management","target":"Account Reconciliation","value":1},
  {"source":"Account Management","target":"Counterparty Risk","value":1},
  {"source":"Account Management","target":"Transaction Engine","value":1},
  {"source":"Account Management","target":"Product Combination","value":1},
  {"source":"Account Management","target":"Fraud Diagnosis","value":1},
  {"source":"Account Management","target":"Fraud Evaluation","value":1},
  {"source":"Cross Product Operations","target":"Operational Services","value":14},
  {"source":"Operational Services","target":"Issued Device Administration","value":1},
  {"source":"Operational Services","target":"Issued Device Tracking","value":1},
  {"source":"Operational Services","target":"Disbursement","value":1},
  {"source":"Operational Services","target":"Open Item Management","value":1},
  {"source":"Operational Services","target":"Leasing Item Administration","value":1},
  {"source":"Operational Services","target":"Customer Billing","value":1},
  {"source":"Operational Services","target":"Reward Points Awards and Redemption","value":1},
  {"source":"Operational Services","target":"Channel Activity Analysis","value":1},
  {"source":"Operational Services","target":"Channel Activity History","value":1},
  {"source":"Operational Services","target":"Card Transaction Switch","value":1},
  {"source":"Operational Services","target":"Delinquent Account Handling","value":1},
  {"source":"Operational Services","target":"Card Collections","value":1},
  {"source":"Operational Services","target":"Internal Bank Account","value":1},
  {"source":"Operational Services","target":"Processing Order","value":1},

  // Business Area: Risk and Compliance
  {"source":"Risk and Compliance","target":"Bank Portfolio and Treasury","value":7},
  {"source":"Bank Portfolio and Treasury","target":"Corporate Treasury Analysis","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Corporate Treasury","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Asset Securitization","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Asset and Liability Management","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Bank Portfolio Analysis","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Bank Portfolio Administration","value":1},
  {"source":"Bank Portfolio and Treasury","target":"Stock Lending and Repos","value":1},
  {"source":"Risk and Compliance","target":"Models","value":13},
  {"source":"Models","target":"Market Risk Models","value":1},
  {"source":"Models","target":"Financial Instrument Valuation Models","value":1},
  {"source":"Models","target":"Gap Analysis","value":1},
  {"source":"Models","target":"Credit Risk Models","value":1},
  {"source":"Models","target":"Liquidity Risk Models","value":1},
  {"source":"Models","target":"Economic Capital","value":1},
  {"source":"Models","target":"Business Risk Models","value":1},
  {"source":"Models","target":"Customer Behaviour Models","value":1},
  {"source":"Models","target":"Fraud Models","value":1},
  {"source":"Models","target":"Credit and Margin Management","value":1},
  {"source":"Models","target":"Production Risk Models","value":1},
  {"source":"Models","target":"Operational Risk Models","value":1},
  {"source":"Models","target":"Contribution Models","value":1},
  {"source":"Risk and Compliance","target":"Business Analysis","value":9},
  {"source":"Business Analysis","target":"Segment Direction","value":1},
  {"source":"Business Analysis","target":"Product Portfolio","value":1},
  {"source":"Business Analysis","target":"Customer Portfolio","value":1},
  {"source":"Business Analysis","target":"Branch Portfolio","value":1},
  {"source":"Business Analysis","target":"Channel Portfolio","value":1},
  {"source":"Business Analysis","target":"Competitor Analysis","value":1},
  {"source":"Business Analysis","target":"Market Research","value":1},
  {"source":"Business Analysis","target":"Market Analysis","value":1},
  {"source":"Business Analysis","target":"Contribution Analysis","value":1},
  {"source":"Risk and Compliance","target":"Regulations and Compliance","value":7},
  {"source":"Regulations and Compliance","target":"Guideline Compliance","value":1},
  {"source":"Regulations and Compliance","target":"Regulatory Compliance","value":1},
  {"source":"Regulations and Compliance","target":"Compliance Reporting","value":1},
  {"source":"Regulations and Compliance","target":"Regulatory Reporting","value":1},
  {"source":"Regulations and Compliance","target":"Fraud Resolution","value":1},
  {"source":"Regulations and Compliance","target":"Financial Accounting","value":1},
  {"source":"Regulations and Compliance","target":"Financial Statement Assessment","value":1},

  // Business Area: Business Support
  {"source":"Business Support","target":"Business Direction","value":5},
  {"source":"Business Direction","target":"Corporate Strategy","value":1},
  {"source":"Business Direction","target":"Corporate Policies","value":1},
  {"source":"Business Direction","target":"Products and Services Direction","value":1},
  {"source":"Business Direction","target":"Enterprise Architecture","value":1},
  {"source":"Business Direction","target":"Continuity Planning","value":1},
  {"source":"Business Support","target":"Business Command and Control","value":6},
  {"source":"Business Command and Control","target":"Organization Direction","value":1},
  {"source":"Business Command and Control","target":"Business Unit Financial Analysis","value":1},
  {"source":"Business Command and Control","target":"Business Unit Financial Operations","value":1},
  {"source":"Business Command and Control","target":"Business Unit Accounting","value":1},
  {"source":"Business Command and Control","target":"Business Unit Direction","value":1},
  {"source":"Business Command and Control","target":"Business Unit Management","value":1},
  {"source":"Business Support","target":"Corporate Relations","value":5},
  {"source":"Corporate Relations","target":"Corporate Communications","value":1},
  {"source":"Corporate Relations","target":"Corporate Alliance and Stakeholder","value":1},
  {"source":"Corporate Relations","target":"Corporate Relationship","value":1},
  {"source":"Corporate Relations","target":"Regulatory and Legal Authority","value":1},
  {"source":"Corporate Relations","target":"Investor Relations","value":1},
  {"source":"Business Support","target":"Buildings Equipment and Facilities","value":7},
  {"source":"Buildings Equipment and Facilities","target":"Property Portfolio","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Site Operations","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Site Administration","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Equipment Maintenance","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Equipment Administration","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Utilities Administration","value":1},
  {"source":"Buildings Equipment and Facilities","target":"Building Maintenance","value":1},
  {"source":"Business Support","target":"Knowledge and Intellectual Property","value":3},
  {"source":"Knowledge and Intellectual Property","target":"Management Manual","value":1},
  {"source":"Knowledge and Intellectual Property","target":"Intellectual Property Portfolio","value":1},
  {"source":"Knowledge and Intellectual Property","target":"Knowledge Exchange","value":1},
  {"source":"Business Support","target":"Document Management and Archive","value":4},
  {"source":"Document Management and Archive","target":"Document Directory","value":1},
  {"source":"Document Management and Archive","target":"Archive Services","value":1},
  {"source":"Document Management and Archive","target":"Correspondence","value":1},
  {"source":"Document Management and Archive","target":"Document Services","value":1},
  {"source":"Business Support","target":"Finance","value":4},
  {"source":"Finance","target":"Financial Statements","value":1},
  {"source":"Finance","target":"Financial Control","value":1},
  {"source":"Finance","target":"Financial Compliance","value":1},
  {"source":"Finance","target":"Enterprise Tax Administration","value":1},
  {"source":"Business Support","target":"Human Resource","value":12},
  {"source":"Human Resource","target":"Human Resources Direction","value":1},
  {"source":"Human Resource","target":"Employee Assignment","value":1},
  {"source":"Human Resource","target":"Employee Data Management","value":1},
  {"source":"Human Resource","target":"Employee and Contractor Contract","value":1},
  {"source":"Human Resource","target":"Employee Certification","value":1},
  {"source":"Human Resource","target":"Employee Evaluation","value":1},
  {"source":"Human Resource","target":"Employee Payroll and Incentives","value":1},
  {"source":"Human Resource","target":"Travel and Expenses","value":1},
  {"source":"Human Resource","target":"Employee Access","value":1},
  {"source":"Human Resource","target":"Employee Benefits","value":1},
  {"source":"Human Resource","target":"Workforce Training","value":1},
  {"source":"Human Resource","target":"Recruitment","value":1},
  {"source":"Business Support","target":"IT Management","value":13},
  {"source":"IT Management","target":"IT Systems Direction","value":1},
  {"source":"IT Management","target":"IT Standards and Guidelines","value":1},
  {"source":"IT Management","target":"Systems Administration","value":1},
  {"source":"IT Management","target":"Development Environment","value":1},
  {"source":"IT Management","target":"System Development","value":1},
  {"source":"IT Management","target":"Production Release","value":1},
  {"source":"IT Management","target":"System Deployment","value":1},
  {"source":"IT Management","target":"System Operations","value":1},
  {"source":"IT Management","target":"Platform Operations","value":1},
  {"source":"IT Management","target":"Systems Helpdesk","value":1},
  {"source":"IT Management","target":"Systems Assurance","value":1},
  {"source":"IT Management","target":"Internal Network Operation","value":1},
  {"source":"IT Management","target":"Operational Gateway","value":1},
  {"source":"Business Support","target":"Non-IT and Non-HR Enterprise Services","value":9},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Legal Compliance","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Internal Audit","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Security Advisory","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Security Assurance","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Approved Supplier Directory","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Procurement","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Company Billing and Payments","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Fixed Asset Register","value":1},
  {"source":"Non-IT and Non-HR Enterprise Services","target":"Legal Advisory","value":1}
];

	
var units = "Services";

var margin = {top: 15, right: 35, bottom: 15, left: 15},
    width = window.innerWidth - margin.left - margin.right,
    height = 8800 - margin.top - margin.bottom;

var formatNumber = d3.format(",.0f"),    // zero decimal places
    format = function(d) { return formatNumber(d) + " " + units; },
    color = d3.scale.category20();

// append the svg canvas to the page
var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

// Set the sankey diagram properties
var sankey = d3.sankey()
    .nodeWidth(36)
    .nodePadding(20)
    .size([width, height]);

var path = sankey.link();

  //set up graph in same style as original example but empty
  graph = {"nodes" : [], "links" : []};

    flare.forEach(function (d) {
      graph.nodes.push({ "name": d.source });
      graph.nodes.push({ "name": d.target });
      graph.links.push({ "source": d.source,
                         "target": d.target,
                         "value": +d.value });
     });

     // return only the distinct / unique nodes
     graph.nodes = d3.keys(d3.nest()
       .key(function (d) { return d.name; })
       .map(graph.nodes));

     // loop through each link replacing the text with its index from node
     graph.links.forEach(function (d, i) {
       graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);
       graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);
     });

     //now loop through each nodes to make nodes an array of objects
     // rather than an array of strings
     graph.nodes.forEach(function (d, i) {
       graph.nodes[i] = { "name": d };
     });

  sankey
    .nodes(graph.nodes)
    .links(graph.links)
    .layout(32);

// add in the links
  var link = svg.append("g").selectAll(".link")
      .data(graph.links)
    .enter().append("path")
      .attr("class", "link")
      .attr("d", path)
      .style("stroke-width", function(d) { return Math.max(1, d.dy); })
      .sort(function(a, b) { return b.dy - a.dy; });

// add the link titles
  link.append("title")
        .text(function(d) {
    		return d.source.name + " - " + 
                d.target.name + "\n" + format(d.value); });

// add in the nodes
  var node = svg.append("g").selectAll(".node")
      .data(graph.nodes)
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { 
		  return "translate(" + d.x + "," + d.y + ")"; })
    .call(d3.behavior.drag()
      .origin(function(d) { return d; })
      .on("dragstart", function() { 
		  this.parentNode.appendChild(this); })
      .on("drag", dragmove));

// add the rectangles for the nodes
  node.append("rect")
      .attr("height", function(d) { return d.dy; })
      .attr("width", sankey.nodeWidth())
      .style("fill", function(d) { 
		  return d.color = color(d.name.replace(/ .*/, "")); })
      .style("stroke", function(d) { 
		  return d3.rgb(d.color).darker(2); })
    .append("title")
      .text(function(d) { 
		  return d.name + "\n" + format(d.value); });

// add in the title for the nodes
  node.append("text")
      .attr("x", -6)
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("text-anchor", "end")
      .attr("transform", null)
      .text(function(d) { return d.name; })
    .filter(function(d) { return d.x < width / 2; })
      .attr("x", 6 + sankey.nodeWidth())
      .attr("text-anchor", "start");

// the function for moving the nodes
  function dragmove(d) {
    d3.select(this).attr("transform", 
        "translate(" + d.x + "," + (
                d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))
            ) + ")");
    sankey.relayout();
    link.attr("d", path);
  };
</script>
</body>
</html>